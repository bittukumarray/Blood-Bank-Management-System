{% extends 'home/base.html' %}
{% block title %}
    Find a potential donor
{% endblock %}
{% block body %}
    <h2 style="margin: 100px">
        {% if result.count == 0 %}
            <h2 style="">Sorry no donors found near you</h2>

        {% else %}
            {% for donor in result %}
                <dt>{{ donor.user.username }}
                <dd>
                    Address: {{ donor.city }},{{ donor.state }}
                </dd>

                </dt>
            {% endfor %}
        {% endif %}

        <h2 style="color: white;margin-top: 50px;">Enter details</h2>
        <div class="bg-warning" style="margin-bottom: 100px;margin-left: 20px;">
            <h3>Find donors:</h3>
            <form action="" method="post" id="find" data-cities-url="{% url 'finddonor:ajax_load_cities' %}">
                {% csrf_token %}
                {% for field in form %}
                    {{ field.errors }}
                    <label>{{ field.label_tag }}</label>
                    {{ field }}
                {% endfor %}
                <br>
                <button type="submit" class="btn btn-success"> Search..</button>
{#                    <button>#}
            </form>
        </div>
        </div>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    {% csrf_token %}
  <script>
    $("#id_state").change(function () {
      var url = $("#find").attr("data-cities-url");  // get the url of the `load_cities` view
      var stateId = $(this).val();  // get the selected country ID from the HTML input

      $.ajax({
        type:"POST",// initialize an AJAX request
        url: '/find-donor/ajax/load-cities/',                    // set the url of the request (= localhost:8000/hr/ajax/load-cities/)
        data: {
          'state': stateId,csrfmiddlewaretoken:'{{ csrf_token }}'     // add the country id to the GET parameters
        },
        success: function (data) {   // `data` is the return of the `load_cities` view function
          $("#id_city").html(data);  // replace the contents of the city input with the data that came from the server
        }
      });

    });
  </script>
{% endblock %}